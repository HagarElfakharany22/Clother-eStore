<!-- checkout.html -->
<div class="checkout-page">
  <div class="checkout-header">
    <h1>Checkout</h1>
    <button class="back-btn" (click)="goToCart()">‚Üê Back to Cart</button>
  </div>

  <!-- Loading -->
  <div class="loading" *ngIf="isLoading">
    <div class="spinner"></div>
    <p>Loading...</p>
  </div>

  <!-- Checkout Content -->
  <div class="checkout-content" *ngIf="!isLoading && cart">
    <!-- Left Side: Cart Items & Shipping Form -->
    <div class="left-section">
      <!-- Cart Items -->
      <div class="cart-preview">
        <h2>Your Cart ({{ cart.items.length }} items)</h2>
        <div class="cart-items-list">
          <div class="cart-item-preview" *ngFor="let item of cart.items">
            <div class="item-image">
              <img [src]="uploadUrl+item.productId.imgURL || 'assets/placeholder.jpg'" [alt]="item.productId.name" />
            </div>
            <div class="item-info">
              <p class="item-name">{{ item.productId.name }}</p>
              <p class="item-details">
                {{ item.productId.price | currency:'EGP' }} √ó {{ item.quantity }}
              </p>
            </div>
            <p class="item-subtotal">{{ getItemSubtotal(item) | currency:'EGP' }}</p>
          </div>
        </div>
      </div>

      <!-- Shipping Form -->
      <div class="shipping-form">
        <h2>Shipping Information</h2>

        <form [formGroup]="checkoutForm">
          <div class="form-row">
            <div class="form-group">
              <label for="governate">Governate *</label>
              <input 
                type="text" 
                id="governate"
                formControlName="governate"
                placeholder="e.g., Cairo"
                [class.error]="checkoutForm.get('governate')?.invalid && checkoutForm.get('governate')?.touched"
              />
              <span class="error-message" *ngIf="checkoutForm.get('governate')?.hasError('required') && checkoutForm.get('governate')?.touched">
                Governate is required
              </span>
            </div>

            <div class="form-group">
              <label for="city">City *</label>
              <input 
                type="text" 
                id="city"
                formControlName="city"
                placeholder="e.g., Nasr City"
                [class.error]="checkoutForm.get('city')?.invalid && checkoutForm.get('city')?.touched"
              />
              <span class="error-message" *ngIf="checkoutForm.get('city')?.hasError('required') && checkoutForm.get('city')?.touched">
                City is required
              </span>
            </div>
          </div>

          <div class="form-group">
            <label for="addressDetails">Address Details *</label>
            <textarea 
              id="addressDetails"
              formControlName="addressDetails"
              placeholder="Street, Building, Floor, Apartment..."
              rows="3"
              [class.error]="checkoutForm.get('addressDetails')?.invalid && checkoutForm.get('addressDetails')?.touched"
            ></textarea>
            <span class="error-message" *ngIf="checkoutForm.get('addressDetails')?.hasError('required') && checkoutForm.get('addressDetails')?.touched">
              Address details are required
            </span>
          </div>

          <div class="form-group">
            <label for="phone">Phone Number *</label>
            <input 
              type="tel" 
              id="phone"
              formControlName="phone"
              placeholder="01XXXXXXXXX"
              [class.error]="checkoutForm.get('phone')?.invalid && checkoutForm.get('phone')?.touched"
            />
            <span class="error-message" *ngIf="checkoutForm.get('phone')?.hasError('required') && checkoutForm.get('phone')?.touched">
              Phone number is required
            </span>
            <span class="error-message" *ngIf="checkoutForm.get('phone')?.hasError('pattern') && checkoutForm.get('phone')?.touched">
              Please enter a valid Egyptian phone number (e.g., 01012345678)
            </span>
          </div>
        </form>
      </div>
    </div>

    <!-- Right Side: Order Summary -->
    <div class="order-summary">
      <h2>Order Summary</h2>

      <div class="summary-row">
        <span>Items ({{ cart.items.length }})</span>
        <span>{{ cart.totalPrice | currency:'EGP' }}</span>
      </div>

      <div class="summary-row">
        <span>Shipping</span>
        <span class="free-shipping">Free</span>
      </div>

      <div class="summary-divider"></div>

      <div class="summary-row total">
        <span>Total</span>
        <span>{{ cart.totalPrice | currency:'EGP' }}</span>
      </div>

      <button 
        class="place-order-btn" 
        (click)="placeOrder()"
        [disabled]="checkoutForm.invalid || isSubmitting"
      >
        <span *ngIf="!isSubmitting">Place Order</span>
        <span *ngIf="isSubmitting">
          <span class="btn-spinner"></span>
          Processing...
        </span>
      </button>

      <p class="secure-note">üîí Secure checkout - Your data is protected</p>
    </div>
  </div>
</div>
