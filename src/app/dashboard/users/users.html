<!-- users.component.html -->
<div class="users-container">
    <!-- Header Section -->
    <div class="header-section">
        <h2>Users Management</h2>
        <div class="stats">
            <div class="stat-card">
                <span class="stat-number">{{ users.length }}</span>
                <span class="stat-label">Total Users</span>
            </div>
            <div class="stat-card blocked">
                <span class="stat-number">{{ blockedCount }}</span>
                <span class="stat-label">Blocked Users</span>
            </div>
        </div>
    </div>

    <!-- Search and Filter -->
    <div class="search-section">
        <input type="text" placeholder="Search users by name, email, or phone..." [(ngModel)]="searchTerm"
            (input)="filterUsers()" class="search-input" />
        <select [(ngModel)]="filterRole" (change)="filterUsers()" class="filter-select">
            <option value="">All Roles</option>
            <option value="user">Users</option>
            <!-- <option value="admin">Admins</option> -->
        </select>
        <select [(ngModel)]="filterBlocked" (change)="filterUsers()" class="filter-select">
            <option value="">All Status</option>
            <option value="false">Active</option>
            <option value="true">Blocked</option>
        </select>
    </div>

    <!-- Users Table -->
    <div class="table-container">
        <table class="users-table" *ngIf="filteredUsers.length > 0; else noData">
            <thead>
                <tr>
                    <th>Name</th>
                    <th>Email</th>
                    <th>Phone</th>
                    <!-- <th>Role</th> -->
                    <th>Address</th>
                    <th>Status</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                <tr *ngFor="let user of filteredUsers" [class.blocked-row]="user.isBlocked">
                    <td>
                        <div class="user-info">
                            <div class="user-avatar">{{ user.name.charAt(0).toUpperCase() }}</div>
                            <span>{{ user.name }}</span>
                        </div>
                    </td>
                    <td>{{ user.email }}</td>
                    <td>{{ user.phone }}</td>
                    <!-- <td>
            <span class="role-badge" [class.admin]="user.role === 'admin'" [class.user]="user.role === 'user'">
              {{ user.role }}
            </span>
          </td> -->
                    <td>
                        <div class="address-info" *ngIf="user.address && user.address.length > 0; else noAddress">
                            <span *ngFor="let addr of user.address; let i = index">
                                {{ addr.governate }}, {{ addr.city }}, {{ addr.addressDetails }}
                                <br *ngIf="i < user.address.length - 1">
                            </span>
                        </div>
                        <ng-template #noAddress>
                            <span class="no-address">No address</span>
                        </ng-template>
                    </td>
                    <td>
                        <span class="status-badge" [class.active]="!user.isBlocked" [class.blocked]="user.isBlocked">
                            {{ user.isBlocked ? 'Blocked' : 'Active' }}
                        </span>
                    </td>
                    <td class="actions">
                        <button class="btn-block" [class.unblock]="user.isBlocked" (click)="toggleBlockUser(user)"
                            [title]="user.isBlocked ? 'Unblock User' : 'Block User'">
                            {{ user.isBlocked ? 'Blocked' : 'Block' }}
                        </button>
                        <button class="btn-view" (click)="viewUser(user)" title="View Details">
                            View Details
                        </button>
                    </td>
                </tr>
            </tbody>
        </table>

        <ng-template #noData>
            <div class="no-data">
                <p>No users found</p>
            </div>
        </ng-template>
    </div>

    <!-- View User Modal -->
    <div class="modal-overlay" *ngIf="showModal" (click)="closeModal()">
        <div class="modal-content" (click)="$event.stopPropagation()">
            <div class="modal-header">
                <h3>User Details</h3>
                <button class="close-btn" (click)="closeModal()">âœ•</button>
            </div>

            <div class="user-details" *ngIf="selectedUser">
                <div class="detail-section">
                    <div class="detail-row">
                        <span class="detail-label">Name:</span>
                        <span class="detail-value">{{ selectedUser.name }}</span>
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Email:</span>
                        <span class="detail-value">{{ selectedUser.email }}</span>
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Phone:</span>
                        <span class="detail-value">{{ selectedUser.phone }}</span>
                    </div>
                    <!-- <div class="detail-row">
            <span class="detail-label">Role:</span>
            <span class="role-badge" [class.admin]="selectedUser.role === 'admin'" [class.user]="selectedUser.role === 'user'">
              {{ selectedUser.role }}
            </span>
          </div> -->
                    <div class="detail-row">
                        <span class="detail-label">Status:</span>
                        <span class="status-badge" [class.active]="!selectedUser.isBlocked"
                            [class.blocked]="selectedUser.isBlocked">
                            {{ selectedUser.isBlocked ? 'Blocked' : 'Active' }}
                        </span>
                    </div>
                </div>

                <div class="detail-section" *ngIf="selectedUser.address && selectedUser.address.length > 0">
                    <h4>Addresses</h4>
                    <div class="address-list">
                        <div class="address-card" *ngFor="let addr of selectedUser.address">
                            <div class="address-header">
                                <strong>{{ addr.governate }}</strong>
                            </div>
                            <p>{{ addr.city }}</p>
                            <p class="address-details">{{ addr.addressDetails }}</p>
                        </div>
                    </div>
                </div>


                <div class="detail-section">
                    <h4>Block/Unblock User</h4>
                    <div class="toggle-action">
                        <label class="toggle-label">
                            <span>{{ selectedUser.isBlocked ? 'User is currently blocked' : 'User is currently active'
                                }}</span>
                            <div class="toggle-container">
                                <input type="checkbox" [checked]="selectedUser.isBlocked"
                                    (change)="toggleBlockUser(selectedUser)" class="toggle-checkbox" id="blockToggle" />
                                <label for="blockToggle" class="toggle-switch"></label>
                                <span class="toggle-text">{{ selectedUser.isBlocked ? 'Blocked' : 'Active' }}</span>
                            </div>
                        </label>
                    </div>
                </div>
            </div>

            <div class="modal-actions">
                <button type="button" class="btn-close" (click)="closeModal()">Close</button>
            </div>
        </div>
    </div>

    <!-- Loading Spinner -->
    <div class="loading-overlay" *ngIf="isLoading">
        <div class="spinner"></div>
    </div>
</div>